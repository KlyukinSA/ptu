# Защита информации

# Задания лаб
## 1
```
# Задание 1. Создание зашифрованных zip-архивов
## Выполните создание из файла opentext.txt зашифрованных архивов в соответствии со следующей таблицей.
## Попробуйте открыть один из архивов при помощи неверного пароля. Убедитесь, что это невозможно.
## Убедитесь, что при указании верного пароля от архива возникает предложение перезаписать уже существующий в текущем каталоге файл opentext.txt. Т.е. извлечение файла становится возможным.
# Задание 2. Исследование времени восстановления паролей
## Выполните следующие команды и зафиксируйте время их выполнения по выводу утилиты time ... Если требуемое для перебора время превышает несколько минут, на пример при восстановлении archive6.zip, продолжать не стоит, достаточно результата полученного для длины 5 символов.
## Выполните указанные выше команды по 3 раза, чтобы иметь возможность усреднить значение времени перебора. Полученные значения времени T1, T2 и T3 для каждого значения длины пароля зафиксируйте в таблице
# Задание 3. Подсчет скорости перебора паролей
## Исходя из полученных в предыдущем пункте данных о времени выполнения восстановления пароля оцените приблизительную скорость перебора в символах в миллисекунду, выполнив подсчет для различных длин пароля. используйте калькулятор. Мощность алфавита - 26. При получении в результатах времени, большего, чем 1 минута, необходимо правильно выполнить преобразование в секунды/милисекунды.
## Используя полученную оценочную скорость перебора (S), оцените предполагаемое время в миллисекундах-секундах-минутах-часах, необходимое для перебора пароля длиной 7 и 8 символов
## Попробуйте изменить мощность словаря, используемого при переборе, убрав ограничение на перебор только по буквам нижнего регистра. Оцените, как в этом случае поменялось время перебора
```
## 2
```
# Задание 1. Установка
Установите программу gnupg (если не установлена) командой. Для этого необходимо перейти контекст безопасности суперпользователя. apt install gnupg
# Задание 2. Генерация пары ключей
## Запустите генератор gpg-ключа командой gpg --gen-key
## Ответьте на вопросы gpg, указав свое реальное имя и адрес электронной почты такие же, как используются на портале ДО (Moodle)Real name: Ivan I. Ivanov Email address: ivanov_ii@cs.spbstu.ru и подтвердите O ввод ранее введенных данных Change (N)ame, (E)mail, or (O)kay/(Q)uit? O
## Выполните ввод секретной фразы (passphrase/фраза-пароль), запомните/запишите её.
## После завершения будет выведен отчет о создании ключа
## Выведите список доступных приватных ключей командой gpg --list-secret-keys
## Выведите список доступных ключей командой gpg --list-keys
# Задание 3. Выполнение экспорта публичного ключа
## Определите идентификатор вашего, ранее сгенерированного публичного ключа, посмотрев список ключей GPG
## Выполните экспорт этого ключа в формате ASCII. Результат экспорта должен быть записан в файл pubkey.asc. Этот файл понадобится как результат выполнения лабораторной работы.
# Задание 4. Выполните импорт открытого ключа
## Выполните импорт открытого ключа, содержащегося в 874A9D18.asc
## Посмотрите список публичных ключей gpg. Убедитесь, что ключ 874A9D18 импортирован, но степень его доверия обозначена как неизвестно
## Выполните подписание указанного ключа своим ключом.
## Посмотрите списко публичных ключей, убедитесь, что импортированный ключ теперь полностью доверяем (степень доверия - полное)
# Задание 5. Выполните шифрование файла средствами GPG
## В материалах лабораторной работы найдите файл open-text.txt, откройте его в редакторе и заполните своей информацией (ФИО, группа, дата)
## Выполните шифрование полученного файла импортированным ключом преподавателя 0x874A9D18, записав результат в файл close-text.asc
## Убедитесь, что файл close-text.asc содержит зашифрованное средствами PGP сообщение
# Задание 6. Создание отсоединенной подписи
## Создайте отсоединенную подпись в текстовом формате для заполненного ранее файла open-text.txt
## Полученный результат (отсоединенная подпись в текстовом формате) должен быть записан в файл open-text.txt.asc (поведение команды создания подписи по-умолчанию).
```
## 3
Написать на python с помощью pynput программу, которая открывает файл log.txt, записывает время начала программы, время нажатия и отпускания в системе и каких клавиш во время выполнения программы и время остановки программы, происходящей по нажатии Esc.
Запустить для своего варианта.
## 4
```
# Задание 1. Создание закрытого ключа и CSR-запроса для узла (FQDN-имя)
## Выясните имя вашего узла с использованием команды hostname
## Выполните генерацию закрытого ключа и CSR-запроса. Закрытый ключ запишите при этом в файл <host>.key, CSR-запрос - в файл <host>.csr, где <host> - имя узла, выясненное в п.1
## В запросах утилиты генерации в обязательном порядке укажите в параметре Common Name (CN) полное доменное имя вашего узла. Для получения полного доменного имени узла (FQDN) дополните имя узла из п.1 доменным суффиксом, например spbstu.ru
## В запросе адреса электронной почты, укажите Ваш адрес почты, под которой Вы зарегистрированы на портале дистанционного обучения dl.spbstu.ru
## Challenge password в запросах оставьте пустым. Остальные запрашиваемые с клавиатуры параметры указывать необязательно.
## Выполните расшифровку содержимого CSR-запроса, обратите внимание на значение поля Subject(Абонент)
# Задание 2. Создание самоподписанного сертификата удостоверяющего центра
## Выполните создание закрытого ключа и самоподписанного сертификата удостоверяющего центра. Самоподписанный сертификат сохраните в файл ca.crt
## Укажите и запомните парольную фразу, которой будет зашифрован закрытый ключ удостоверяющего центра.
## В качестве CN (Common Name) укажите “Infsec Course CA”,
## В запросе адреса электронной почты, укажите адрес почты, под которой Вы зарегистрированы на портале дистанционного обучения
## Посмотрите расшифровку содержимого сертификата и убедитесь, что записи Subject(Абонент) и Issuer(Выдавший) содержат одно и то же значение, т.е. сертификат самоподписанный
# Задание 3. Подпись ключом CA CSR-запроса
## Выполните подпись CSR-запроса для вашего узла, полученного в Задании 1 закрытым ключом удостоверяющего центра, созданного в Задании 2
## Полученный в результате сертификат узла запишите в файл <host>.crt, где host - имя вашего узла, как было определено в Задании 1.
## При запросе парольной фразы укажите ранее вводимую парольную фразу для выполнения дешифрирования приватного ключа.
## Полученный файл с сертификатом узла является одним из результатов лабораторной работы.
```
## 5
Написать на python с помощью hashlib программу которая читает файлы 1.txt - 10.txt из текущей дирекотрии, вычисляет их хуш-сумму с помощью алгоритма sha256, записывает полученные хеш-суммы в текстовый файл HashList.txt, запускает программу FC, заново вычисляет хеш-суммы файлов, сравнивает полученные хеш-суммы со списками HashList.txt и VirusHashList.txt в текущей диктоктории, состоящими из строк хеш-сумм, печатает список хеш-сумм оригинальных, измененных (хеш-сумма отличается от первоначальной в HashList.txt) и зараженных (хеш-сумма находится в VirusHashList.txt) файлов, удаляет зараженные файлы.
Запустить для своего варианта.
## 6
```
# Задание 1. Установка john, hashcat и словаря для атак перебора
## Выполните установку утилит john и hashcat
## Скачайте типовой словарь rockyou, воспользовавшись ссылкой, приведенной выше
## Протестируйте скорость работы hashcat, сравните его скорость для различных хэш-алгоритмов
# Задание 2. Восстановление паролей из хэш-образов MD5 по словарю
## Убедитесь в присутствии в используемом словаре следующих слов: 17barb1e, suriken77, 007potatoice
## Сгенерируйте хэши MD5 для этих слов и сохраните их в файл, как было показано в примерах выше
## При помощи hashcat выполните восстановление паролей из образов.
## Результат восстановления сохраните в файл result.md5
# Задание 3. Восстановление паролей из хэш-образов SHA512 по словарю
## Возьмите 5 случайных парольных комбинаций, присутствующих в используемом словаре (проверьте) , но не используемых ранее в примерах и заданиях.
## Сгенерируйте хэши SHA512 для этих слов и сохраните их в файл, как было показано в примерах выше. Команду генерации кэшей найдите самостоятельно.
## При помощи hashcat выполните восстановление паролей из образов. Значение параметра -m для восстановления образов SHA512 определите по man-странице утилиты hashcat
## Результат восстановления сохраните в файл result.sha512
# Задание 4. Восстановление паролей из хэш-образов MD5 методом перебора
## Создайте с использованием генератора псевдослучайных чисел 4 парольные комбинации, длиной по 5 символов каждая, не используемых ранее в примерах и заданиях.
## Проверьте их отсутствие в используемом словаре.
## Сгенерируйте хэши MD5 для этих слов и сохраните их в файл, по аналогии с предыдущими заданиями.
## При помощи hashcat выполните восстановление паролей из образов.
## Результат восстановления сохраните в файл result-random.md5
```
## 7
```
# Задание 1. Установка инструментов для работы с сообщениями аудита
## Выполните установку пакета auditd.
## Выполните запуск службы аудита.
## Настройте автозапуск службы аудита.
## Ознакомьтесь с рабочим списком правил аудита (скорее всего окажется пустым).
# Задание 2. Настройки системы аудита и его журнал
## Ознакомьтесь с конфигурационном файлом службы аудита.
## Определите файл с журналом аудита - его расположение задается параметром log_file в конфигурационном файле службы.
## Ознакомьтесь с содержимым журнала аудита.
# Задание 3. Добавление правил отслеживания обращения к файлам
## Выполните добавление правил аудита, отслеживающих обращение на запись к файлам /etc/group, /etc/passwd, /etc/shadow. Задайте для соответствующих событий ключи поиска etc_group, etc_passwd, etc_shadow соответственно.
## Убедитесь, что правила добавлены и активны.
# Задание 4. Выполнение действий, отслеживаемых системой аудита
## При помощи утилит useradd, groupadd, usermod, passwd выполните создание нового пользователя, создание новой группы, добавление созданного пользователя в созданную группу, установку пароля пользователя.
## Выполните вход в систему под созданным пользователем. Выполненные в данном задании действия должны будут зафиксироваться в журнале аудита в соответствии с установленными вами ранее правилами.
# Задание 5. Создание отчета по событиям доступа к файлам.
## Выполните создание отчета по отслеживаемым файлам.
## Убедитесь по отчету, что в журнал аудита были записаны события записи в файл /etc/shadow при создании пользователя.
## Запишите содержимое отчета в файл shadow.report
# Задание 6. Поиск события в журнале аудита
## По заданном в задании 3 ключу для обращения к файлу с паролями пользователей (/etc/shadow) выполните средствами утилиты ausearch поиск в журнале аудита событий с данным ключом. Результат поиска должен содержать полное описание события - установки пароля пользователя утилитой passwd.
## Запишите результат поиска в файл shadow.search
```
## 8
Необходимо создать простейший blockchain на python, имитирующий работу цепочки блоков, связанных между собой с помощью хеширования и ссылки на предыдущий блок. Блоки содержат внутри себя некоторые данные, представленные в текстовом виде, время их создания, хеш предыдущего блока, работающий по консенсусу proof of work. Для цепи необходимо реализовать проверку её валидности путём сравнения хешей рассчитываемых блоков. Возможность указания временной сложности добычи блока и сложности хеширования в формате “00000000”.
Создать несколько блоков и провалидировать.
## 9
```
# 1.3. Задание 1. Установка необходимых компонент (Debian Linux)
## 1. Выполните установку следующих пакетов: auditd apparmor-utils
## 2. Убедитесь, что служба аудита работает
## 3. Убедитесь, что применяются политики мандатного доступа
# 1.4. Задание 2. Получение исходного кода, сборка, установка тестового приложения
## 1. Скачайте исходный код используемого приложения
## 2. Перейдите в каталог с файлами 6-ой лабораторной
## 3. Выполните сборку и установку приложения
# 1.5. Задание 3. Тестовый запуск приложения без действующих ограничений политики мандатного доступа.
## 1. Убедитесь, что приложение присутствует по пути /usr/local/bin/macapp
## 2. Выполните его запуск. Приложение не должно выдавать никаких сообщений в процессе работы.
## 3. Переключитесь на другой терминал и убедитесь, что приложение смогло создать свой файл журнала, открыть на прослушивание порт и скопировать во временный каталог закрытый ключ.
## 4. Вернувшись в терминал с запущенным приложением завершите его работу
## 5. Удалите создаваемые приложением файлы
# 1.6. Задание 4. Создание минимальной политики Apparmor
## 1. Создайте в /etc/apparmor.d файл политики с именем usr.local.bin.macapp
## 2. Добавьте в него следующее содержание.
## 3. Выполните применение (загрузку в ядро) указанной минимальной политики.
## 4. Убедитесь что политика действует в ограничивающем (enforce) режиме
# 1.7. Задание 5. Запуск приложения при действующих запретах политики мандатного доступа
## 1. Выполните запуск приложения
## 2. Убедитесь по выводу ошибок, что выполняемые приложением действия, реализуемые через механизм системных вызовов, приложению сделать не удается.
## 3. Перейдите на другой терминал. Посмотрите на сообщения системы аудита, связанные с механизмом мандатного доступа по журналу событий системы
## 4. Убедитесь, что приложение не смогло открыть порт на прослушивание, создать и открыть на запись файл журнала, а также скопировать ключ.
# 1.8. Задание 6. Написание полностью разрешающий политики мандатного доступа
## 1. Последовательно (по одному) добавляйте в применяемую для приложения политику мандатного доступа установки, разрешающие выполнение запрашиваемых им действий
## 2. После добавления каждой из установок, выполняйте применение (загрузку в ядро) изменений политики.
## 3. Запускайте приложение и наблюдая за ошибками, убедитесь, что добавлено разрешение действует.
## 4. После добавления всех 4-ех разрешений приложение должно запускаться без сообщений об ошибках.
# 1.9. Задание 7. Запрет доступа к SSH-ключу сервера
## 1. Откройте политику мандатного доступа для приложения и удалите строку, разрешающую доступ к SSH-ключу.
## 2. Выполняйте применение (загрузку в ядро) изменений политики.
## 3. Запустите приложение и убедитесь, что оно может выполнять все предусмотренные им действия, кроме доступа к ключу.
# 1.10. Итоговое задание.
## Результатом выполнения данной лабораторной является следующая выбор-
ка из файла журнала: journalctl -e | grep AVC
## Файл avc.log находящийся в каталоге /tmp необходимо подгрузить на портал Moodle, как результат выполнения лабораторной работы. Условием успешности выполнения работы будет наличие в файле журнала аудита заблокированных по итогам выполнения Заданий 5 и 7 событий.
```

# Вопросы
## 1

- Структура команды при запуске брутфорса
- За что каждый ключ отвечает
- С каких символов начинается перебор
- Как изменить это
- Как вскрыть .tar
- как открыть архив у которого пароль 3 пробела
- что если поставить !!!

## 2

- удалите и снова создайте ключ
- создайте с другим методом шифрования
- что такое gpg
    зачем нужно
- что такое ключ armor
    это текстовый (не бинарный)
- как отозвать подпись у ключа
    `--detach-sign`
- какой алгоритм используется по умолчанию
    RSA
- как задавать алгоритм шифрования ключей
    `gpg --full-generate-key`
    и там задать
- что такое fingerprint
- чем отличается уровень доверия абсолютный от полного
    разница только в том что вы создатель ключа, если уровень доверия абсолютный
- как удалить ключ
    `gpg --delete-keys ID`
- для секретных ключей
    `gpg --delete-secret-keys ID`
- как отозвать подпись у импортированного ключа
    --edit-key revsig
- как и зачем используется адрес электронной почты? Обязательно ли писать именно почту?

## 3
- кириллицу показывает?
    надо бы чтобы показывало. так можно сделать

## 4

- что такое PKI
    Public Key Infrastructure
- чем отличается от публичных ключей в gpg
    тем что нужно для сетевого взаимодействия
- может ли подтвержденный сертификат выйти из срока
    ну да мы устанавливаем срок как там 10 лет

## 5

- какую версию алгоритма sha вы используете
- в чем разница между sha1, sha2 и sha3
- какой размер хэша получается при использовании используемого алгоритма (у меня sha256)?

## 6

- почему sha512 дольше считается
- зачем тогда md5

# Темы лекций

1. Основные понятия и определения
1. Основы криптографии
1. Симметричная криптография
1. Хэш-функции
1. Ассиметричная криптография
1. PKI
1. Подсистема защиты ОС
1. Дискреционный доступ в UNIX/Linux
1. Мандатный доступ
1. Мандатный доступ (SELinux targeted)
1. Создание политики мандатного доступа
1. Атаки с внедрением кода
1. Мандатный контроль доступа - Модель Белла-ЛаПадула. PARSEC
1. Уязвимости сетевых протоколов и служб
1. Основы сетевой безопасности
1. Межсетевые экраны. Фильтрация пакетов
1. IDS. Системы обнаружения вторжений
1. NIDS. Сетевые системы обнаружения / предотвращения вторжений
1. Технологии изоляции в защите информации
